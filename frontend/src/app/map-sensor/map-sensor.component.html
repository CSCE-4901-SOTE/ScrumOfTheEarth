<header class="navbar">
    <div class="navbar-left">
      <img src="assets/dashfarmhouse.png" alt="Farmhouse Logo" class="logo">
    </div>
  
    <div class="navbar-center">
      <nav>
        <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
        <a routerLink="/map-sensor" routerLinkActive="active">Map Sensor</a>
        <a routerLink="/alert" routerLinkActive="active">Alert</a>
      </nav>
    </div>

    <button class="menu-button" (click)="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="dropdown-menu" *ngIf="menuOpen">
      <div class="dropdown-header">
        <div class="user-icon">üë§</div>
        <div class="user-info">
          <strong>Name</strong><br />
          <small>RBAC</small>
        </div>
      </div>
      <hr />
      <a href="#">Edit Profile</a>
      <a href="#">Contact</a>
      <a href="#">Report</a>
      <a href="#">Sign Out</a>
    </div>
</header>


<!-- Map Sensor Layout -->
<div class="map-layout">

  <!-- Left Side -->
  <div class="left-panel">

    <!-- Search bar -->
    <div class="sidebar">
      <div class="search-wrapper">
        <span class="material-icons search-icon">search</span>
        <input 
          type="text"
          placeholder="Search sensor"
          [(ngModel)]="searchSensor"
          class="search-box"
        />
      </div>
    </div>

    <p *ngIf="noResultFound" class="no-result-text">
      No results found
    </p>


    <!-- Sensor List -->
    <div class="sensor-list">
      <div class="sensor-card" 
           *ngFor="let s of filteredSensors"
           (click)="focusSensor(s)">
        <div class="sensor-header">
          <h4 class="sensor-name">{{ s.name }}</h4>
          <span class="status-icon" [ngClass]="s.status"></span>

          <span *ngIf="s.status === 'deactivate'" class="material-icons cloud-off-icon">cloud_off</span>
        </div>

        <p class="sensor-id">ID: {{ s.id }}</p>

        <div class="sensor-coords">
          <span class="material-icons coord-icon">location_on</span>
          <span>{{ s.latitude }}, {{ s.longitude }}</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Map Right Side -->
  <div class="map-container">
    <div id="sensor-map"></div>
    <div 
      class="overlay" 
      *ngIf="selectedSensor"
      (click)="selectedSensor = null">
    </div>

  <!-- Floating Sensor Detail Card -->
    <div class="sensor-detail-card" *ngIf="selectedSensor">
      <div class="header">
        <h2>{{ selectedSensor.name }}</h2>
        <span 
          class="status-dot" 
          [ngClass]="selectedSensor.status">
        </span>
        <button class="close-btn" (click)="selectedSensor = null">‚úï</button>
      </div>

      <p class="id-line">Sensor ID: {{ selectedSensor.id }}</p>
      <p class="tech-line">Technician: James Haden</p>

      <p class="coords">
        üìç {{ selectedSensor.latitude }}, {{ selectedSensor.longitude }}
      </p>

      <hr>

      <div class="signal-section">
        <div class="signal-row">
          <strong class="signal-text">Signal Strength:</strong>
          <!-- ‚≠ê Signal Bar -->
          <div class="signal-bars">
            <span [class.active]="signalLevel >= 1"></span>
            <span [class.active]="signalLevel >= 2"></span>
            <span [class.active]="signalLevel >= 3"></span>
            <span [class.active]="signalLevel >= 4"></span>
            <span [class.active]="signalLevel >= 5"></span>

            <!-- Tooltip -->
            <div class="signal-tooltip-white">
              {{ signalLabel }}
            </div>
          </div>
        </div>

        <div class="packet-loss-row">
          <strong class="packet-loss-text">Packet Loss:</strong>

          <div class="packet-loss-bars">
            <span [class.active]="packetLossLevel >= 1" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 2" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 3" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 4" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 5" [attr.lvl]="packetLossLevel"></span>

            <div class="packet-loss-tooltip">
              {{ packetLossLabel }}
            </div>
          </div>
        </div>

        <div class="battery-wrapper">
          <label><strong>Battery:</strong></label>
          <div class="battery-bar">
            <div class="battery-fill" style="width: 75%;"></div>
          </div>
          <span class="battery-text">75%</span>
        </div>
      </div>

      <div class="sensor-mini-boxes">

        <div class="box temp">
          <p class="label">Temperature</p>
          <p class="value">75¬∞F</p>
        </div>

        <div class="box moisture">
          <p class="label">Soil Moisture</p>
          <p class="value">30%</p>
        </div>

        <div class="box light">
          <p class="label">Light</p>
          <p class="value">199 lx</p>
        </div>
      </div>
    </div>
  <!-- ‚≠ê‚≠ê‚≠ê End Floating Card ‚≠ê‚≠ê‚≠ê -->
  </div>
</div>

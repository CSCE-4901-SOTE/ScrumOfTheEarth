<!-- Navbar -->
<header class="navbar">
    <!-- Navbar Left -->
    <div class="navbar-left">
      <img src="assets/dashfarmhouse.png" alt="Farmhouse Logo" class="logo">
    </div>
  
    <!-- Navbar Center -->
    <div class="navbar-center">
      <nav>
        <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
        <a routerLink="/map-sensor" routerLinkActive="active">Map Sensor</a>
        <a routerLink="/alert" routerLinkActive="active">Alert</a>
      </nav>
    </div>

    <!-- Menu Button -->
    <button class="menu-button" (click)="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Dropdown Menu -->
    <div class="dropdown-menu" *ngIf="menuOpen">
      <div class="dropdown-header">
        <div class="user-icon">üë§</div>
        <div class="user-info">
          <strong>Name</strong><br />
          <small>RBAC</small>
        </div>
      </div>
      <hr />
      <a href="#">Edit Profile</a>
      <a href="#">Contact</a>
      <a href="#">Report</a>
      <a href="#">Sign Out</a>
    </div>
</header>


<!-- Map Layout -->
<div class="map-layout">
  <!-- Left Panel -->
  <div class="left-panel">
    <!-- Search bar -->
    <div class="sidebar">
      <div class="search-wrapper">
        <span class="material-icons search-icon">search</span>
        <input 
          type="text"
          placeholder="Search sensor"
          [(ngModel)]="searchSensor"
          class="search-box"
        />
      </div>
    </div>

    <!-- No Result Text -->
    <p *ngIf="noResultFound" class="no-result-text">
      No results found
    </p>


    <!-- Sensor List -->
    <div class="sensor-list">
      <div class="sensor-card" 
           *ngFor="let s of filteredSensors"
           (click)="focusSensor(s)">
        <div class="sensor-header">
          <h4 class="sensor-name">{{ s.name }}</h4>
          <span class="status-icon" [ngClass]="s.status"></span>
          <span *ngIf="s.status === 'deactivate'" class="material-icons cloud-off-icon">cloud_off</span>
        </div>

        <!-- Sensor ID -->
        <p class="sensor-id">ID: {{ s.id }}</p>
        <!-- Sensor Coordinates -->
        <div class="sensor-coords">
          <span class="material-icons coord-icon">location_on</span>
          <span>{{ s.latitude }}, {{ s.longitude }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Map Container -->
  <div class="map-container">
    <div id="sensor-map"></div>
    <div 
      class="overlay" 
      *ngIf="selectedSensor"
      (click)="selectedSensor = null">
    </div>

    <!-- Sensor Detail Card -->
    <div class="sensor-detail-card" *ngIf="selectedSensor">
      <!-- Detail Header -->
      <div class="header">
        <h2>{{ selectedSensor.name }}</h2>
        <span 
          class="status-dot" 
          [ngClass]="selectedSensor.status">
        </span>
        <button class="close-btn" (click)="selectedSensor = null">‚úï</button>
      </div>

      <!-- Detail Basic Info -->
      <p class="id-line">Sensor ID: {{ selectedSensor.id }}</p>
      <!-- Technician line of farmer -->
        <p class="tech-line" *ngIf="role === 'farmer'">Technician: James Haden</p>
      <!-- Farmer line of technician -->
        <p class="tech-line" *ngIf="role === 'technician'">Customer: Apple Butter Farmhouse</p>

      <p class="coords">
        üìç {{ selectedSensor.latitude }}, {{ selectedSensor.longitude }}
      </p>

      <hr>

      <!-- Signal Section -->
      <div class="signal-section">
        <!-- Signal Strength -->
        <div class="signal-row">
          <strong class="signal-text">Signal Strength:</strong>
          <div class="signal-bars">
            <span [class.active]="signalLevel >= 1" [attr.lvl]="signalLevel"></span>
            <span [class.active]="signalLevel >= 2" [attr.lvl]="signalLevel"></span>
            <span [class.active]="signalLevel >= 3" [attr.lvl]="signalLevel"></span>
            <span [class.active]="signalLevel >= 4" [attr.lvl]="signalLevel"></span>
            <span [class.active]="signalLevel >= 5" [attr.lvl]="signalLevel"></span>

            <div class="signal-tooltip-white">
              {{ signalLabel }}
            </div>
          </div>
        </div>

        <!-- Packet Loss -->
        <div class="packet-loss-row">
          <strong class="packet-loss-text">Packet Loss:</strong>

          <div class="packet-loss-bars">
            <span [class.active]="packetLossLevel >= 1" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 2" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 3" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 4" [attr.lvl]="packetLossLevel"></span>
            <span [class.active]="packetLossLevel >= 5" [attr.lvl]="packetLossLevel"></span>

            <div class="packet-loss-tooltip">
              {{ packetLossLabel }}
            </div>
          </div>
        </div>

        <!-- Battery -->
        <div class="battery-wrapper">
          <strong>Battery:</strong>
          <div class="battery-bar">
            <div 
              class="battery-fill"
              [style.width.%]="batteryLevel"
              [ngClass]="batteryColorClass">
            </div>
          </div>
          <span class="battery-text">{{ batteryLevel }}%</span>
        </div>
      </div>

      <!-- Farmer: Mini Box Section -->
      <div class="sensor-mini-boxes" *ngIf="role === 'farmer'">
        <!-- Temperature Box -->
        <div class="box temp" [ngClass]="tempColor">
          <p class="label">Temperature</p>
          <p class="value">{{ tempValue }}¬∞F</p>
        </div>

        <!-- Moisture Box -->
        <div class="box moisture" [ngClass]="moistColor">
          <p class="label">Soil Moisture</p>
          <p class="value">{{ moistValue }}%</p>
        </div>

        <!-- Light Box -->
        <div class="box light" [ngClass]="lightColor">
          <p class="label">Light</p>
          <p class="value">{{ lightValue }} lx</p>
        </div>
      </div>

      <!-- Technician: Mini Box Section -->
      <div class="action-buttons" *ngIf="role === 'technician'">
        <button
          class="btn btn-activate"
          (click)="activateSelected(); $event.stopPropagation()">
          Activate
        </button>

        <button
          class="btn btn-deactivate"
          (click)="deactivateSelected(); $event.stopPropagation()">
          Deactivate
        </button>
      </div>
    </div>
  </div>
</div>

